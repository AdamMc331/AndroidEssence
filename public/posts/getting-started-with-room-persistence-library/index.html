<!DOCTYPE html>
<html lang="en-us"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="content-type" content="text/html">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title itemprop="name">Getting Started With Room Persistence Library | Android Essence</title>
<meta property="og:title" content="Getting Started With Room Persistence Library | Android Essence" />
<meta name="twitter:title" content="Getting Started With Room Persistence Library | Android Essence" />
<meta itemprop="name" content="Getting Started With Room Persistence Library | Android Essence" />
<meta name="application-name" content="Getting Started With Room Persistence Library | Android Essence" />
<meta property="og:site_name" content="Android Essence" />

<meta name="description" content="Simplified Android Development">
<meta itemprop="description" content="Simplified Android Development" />
<meta property="og:description" content="Simplified Android Development" />
<meta name="twitter:description" content="Simplified Android Development" />

<meta property="og:locale" content="en-us" />
<meta name="language" content="en-us" />

  <link rel="alternate" hreflang="en-us" href="http://localhost:1313/posts/getting-started-with-room-persistence-library/" title="" />





    
    
    

    <meta property="og:type" content="article" />
    <meta property="og:article:published_time" content=2017-06-10T00:00:00Z />
    <meta property="article:published_time" content=2017-06-10T00:00:00Z />
    <meta property="og:url" content="http://localhost:1313/posts/getting-started-with-room-persistence-library/" />

    
    <meta property="og:article:author" content="Adam McNeilly" />
    <meta property="article:author" content="Adam McNeilly" />
    <meta name="author" content="Adam McNeilly" />
    
    

    

    <script defer type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "Article",
        "headline": "Getting Started With Room Persistence Library",
        "author": {
        "@type": "Person",
        "name": ""
        },
        "datePublished": "2017-06-10",
        "description": "",
        "wordCount":  954 ,
        "mainEntityOfPage": "True",
        "dateModified": "2017-06-10",
        "image": {
        "@type": "imageObject",
        "url": ""
        },
        "publisher": {
        "@type": "Organization",
        "name": "Android Essence"
        }
    }
    </script>


<meta name="generator" content="Hugo 0.148.2">

    
    <meta property="og:url" content="http://localhost:1313/posts/getting-started-with-room-persistence-library/">
  <meta property="og:site_name" content="Android Essence">
  <meta property="og:title" content="Getting Started With Room Persistence Library">
  <meta property="og:description" content="This year at Google I/O, the Android team announced Android Architecture Components a combination of new, helpful libraries for Android development. One that particularly interested me was the Room Persistence Library, which is an abstraction layer of SQLite designed to make database access and creation a lot easier. Right off the bat it reminded me of Realm, which I learned about at Droidcon NYC and really admired, so I decided to dive in and build a todo list using Room &amp; RxJava.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2017-06-10T00:00:00+00:00">
    <meta property="article:modified_time" content="2017-06-10T00:00:00+00:00">


    
    
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Getting Started With Room Persistence Library">
  <meta name="twitter:description" content="This year at Google I/O, the Android team announced Android Architecture Components a combination of new, helpful libraries for Android development. One that particularly interested me was the Room Persistence Library, which is an abstraction layer of SQLite designed to make database access and creation a lot easier. Right off the bat it reminded me of Realm, which I learned about at Droidcon NYC and really admired, so I decided to dive in and build a todo list using Room &amp; RxJava.">


    

    <link rel="canonical" href="http://localhost:1313/posts/getting-started-with-room-persistence-library/">
    <link href="/style.min.2d921c18cf1ec555ffc03d59a8adc211c402c68c930c27d6a0c306ab175a8d09.css" rel="stylesheet">
    <link href="/code-highlight.min.706d31975fec544a864cb7f0d847a73ea55ca1df91bf495fd12a177138d807cf.css" rel="stylesheet">

    
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg">
    <link rel="shortcut icon" href="/favicon.ico">




<link rel="manifest" href="http://localhost:1313/site.webmanifest">

<meta name="msapplication-config" content="/browserconfig.xml">
<meta name="msapplication-TileColor" content="#2d89ef">
<meta name="theme-color" content="#434648">

    
    <link rel="icon" type="image/svg+xml" href="/icons/favicon.svg">

    
    
</head>
<body data-theme = "dark" class="notransition">

<script src="/js/theme.js"></script>

<div class="navbar" role="navigation">
    <nav class="menu" aria-label="Main Navigation">
        <a href="http://localhost:1313/" class="logo">
            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" 
viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" 
stroke-linejoin="round" class="feather feather-home">
<title>Home</title>
<path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
<polyline points="9 22 9 12 15 12 15 22"></polyline>
</svg>
        </a>
        <input type="checkbox" id="menu-trigger" class="menu-trigger" />
        <label for="menu-trigger">
            <span class="menu-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" stroke="currentColor" fill="none" viewBox="0 0 14 14"><title>Menu</title><path stroke-linecap="round" stroke-linejoin="round" d="M10.595 7L3.40726 7"></path><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 3.51488L3.49301 3.51488"></path><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 10.4851H3.49301"></path><path stroke-linecap="round" stroke-linejoin="round" d="M0.5 12.5V1.5C0.5 0.947715 0.947715 0.5 1.5 0.5H12.5C13.0523 0.5 13.5 0.947715 13.5 1.5V12.5C13.5 13.0523 13.0523 13.5 12.5 13.5H1.5C0.947715 13.5 0.5 13.0523 0.5 12.5Z"></path></svg>
            </span>
        </label>

        <div class="trigger">
            <ul class="trigger-container">
                
                
                <li>
                    <a class="menu-link " href="/">
                        Home
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link active" href="/posts/">
                        Posts
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link " href="/about/">
                        About
                    </a>
                    
                </li>
                
                <li class="menu-separator">
                    <span>|</span>
                </li>
                
                
            </ul>
            <a id="mode" href="#">
                <svg xmlns="http://www.w3.org/2000/svg" class="mode-sunny" width="21" height="21" viewBox="0 0 14 14" stroke-width="1">
<title>LIGHT</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></circle><line x1="7" y1="0.5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="0.5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line></g></svg>
                <svg xmlns="http://www.w3.org/2000/svg" class="mode-moon" width="21" height="21" viewBox="0 0 14 14" stroke-width="1">
<title>DARK</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></circle><line x1="7" y1="0.5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="0.5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line></g></svg>
            </a>
        </div>
    </nav>
</div>

<div class="wrapper post">
    <main class="page-content" aria-label="Content">
        <article>
            <header class="header">
                <h1 class="header-title">Getting Started With Room Persistence Library</h1>
                
                
                
                <div class="post-meta">
                    <time datetime="2017-06-10T00:00:00&#43;00:00" itemprop="datePublished"> Jun 10, 2017 </time>
                </div>
                
            </header>
            
            <div class="page-content">
                <p>This year at Google I/O, the Android team announced <a href="https://developer.android.com/topic/libraries/architecture/index.html">Android Architecture Components</a> a combination of new, helpful libraries for Android development. One that particularly interested me was the <a href="https://developer.android.com/topic/libraries/architecture/room.html">Room Persistence Library</a>, which is an abstraction layer of SQLite designed to make database access and creation a lot easier. Right off the bat it reminded me of <a href="https://realm.io/products/realm-mobile-database/">Realm</a>, which I learned about at <a href="https://www.youtube.com/watch?v=QT7XD1hifkU">Droidcon NYC</a> and really admired, so I decided to dive in and build a todo list using Room &amp; RxJava.</p>
<h2 id="update">Update</h2>
<p>I am leaving this information for legacy sake, but about a year after this was published I wrote <a href="/posts/breaking-the-buzzwords-barrier-room-rx-repository/">again</a> on the topic, including some new info and a little nice Kotlin syntax.</p>
<h1 id="project-setup">Project Setup</h1>
<p>First, add the following dependencies to your app&rsquo;s <code>build.gradle</code> file. The Kotlin dependency is optional, but it&rsquo;s the language I&rsquo;ll be using for this tutorial.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-groovy" data-lang="groovy"><span class="line"><span class="cl"><span class="n">compile</span> <span class="s2">&#34;android.arch.persistence.room:runtime:$roomLibraryVersion&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">compile</span> <span class="s2">&#34;android.arch.persistence.room:rxjava2:$roomLibraryVersion&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">compile</span> <span class="s2">&#34;io.reactivex.rxjava2:rxjava:$rxJavaVersion&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">compile</span> <span class="s2">&#34;io.reactivex.rxjava2:rxandroid:$rxAndroidVersion&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">annotationProcessor</span> <span class="s2">&#34;android.arch.persistence.room:compiler:$roomLibraryVersion&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">kapt</span> <span class="s2">&#34;android.arch.persistence.room:compiler:$roomLibraryVersion&#34;</span>
</span></span></code></pre></div><p>If you&rsquo;re not using Kotlin, you also don&rsquo;t need the <code>kapt</code> line at the end. That&rsquo;s for Kotlin annotation processing. Here are all of the version numbers used in this tutorial:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-groovy" data-lang="groovy"><span class="line"><span class="cl"><span class="n">roomLibraryVersion</span> <span class="o">=</span> <span class="s2">&#34;1.0.0-alpha1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">rxJavaVersion</span> <span class="o">=</span> <span class="s2">&#34;2.0.6&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">rxAndroidVersion</span> <span class="o">=</span> <span class="s2">&#34;2.0.1&#34;</span>
</span></span></code></pre></div><p>You can get more information or the latest versions <a href="https://developer.android.com/topic/libraries/architecture/adding-components.html">here</a>.</p>
<h1 id="task-entity">Task Entity</h1>
<p>An <a href="https://developer.android.com/topic/libraries/architecture/room.html#entities">Entity</a> is a class that represents a database row. In this application, we&rsquo;ll have a table of <code>Task</code> objects that the user has to complete, so we can annotate our class with the <code>@Entity</code> annotation. We can also use annotations like <code>@PrimaryKey</code> to define which property should be the primary key, and even autogenerate one if necessary:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="nd">@Entity</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Task</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@PrimaryKey</span><span class="p">(</span><span class="n">autoGenerate</span> <span class="p">=</span> <span class="k">true</span><span class="p">)</span> <span class="k">var</span> <span class="py">id</span><span class="p">:</span> <span class="n">Int</span> <span class="p">=</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">    <span class="k">var</span> <span class="py">description</span><span class="p">:</span> <span class="n">String</span> <span class="p">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">var</span> <span class="py">completed</span><span class="p">:</span> <span class="n">Boolean</span> <span class="p">=</span> <span class="k">false</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">constructor</span><span class="p">(</span><span class="n">description</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span> <span class="n">completed</span><span class="p">:</span> <span class="n">Boolean</span> <span class="p">=</span> <span class="k">false</span><span class="p">):</span> <span class="k">this</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="n">description</span> <span class="p">=</span> <span class="n">description</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="n">completed</span> <span class="p">=</span> <span class="n">completed</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h1 id="task-dao">Task DAO</h1>
<p>A <a href="https://developer.android.com/topic/libraries/architecture/room.html#daos">DAO</a>, or Database Access Object is an interface used to abstract access to the database. This is where you put all of your CRUD (Create, Read, Update, Delete) methods. Below is the code for our DAO, but please check the documentation for additional information:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="nd">@Dao</span>
</span></span><span class="line"><span class="cl"><span class="k">interface</span> <span class="nc">TaskDAO</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Query</span><span class="p">(</span><span class="s2">&#34;SELECT * FROM task&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">fun</span> <span class="nf">getAll</span><span class="p">():</span> <span class="n">Flowable</span><span class="p">&lt;</span><span class="n">List</span><span class="p">&lt;</span><span class="n">Task</span><span class="p">&gt;&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Query</span><span class="p">(</span><span class="s2">&#34;SELECT * FROM task WHERE completed = :arg0&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">fun</span> <span class="nf">getTasksByCompletion</span><span class="p">(</span><span class="n">complete</span><span class="p">:</span> <span class="n">Boolean</span><span class="p">):</span> <span class="n">Flowable</span><span class="p">&lt;</span><span class="n">List</span><span class="p">&lt;</span><span class="n">Task</span><span class="p">&gt;&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Insert</span>
</span></span><span class="line"><span class="cl">    <span class="k">fun</span> <span class="nf">insertAll</span><span class="p">(</span><span class="k">vararg</span> <span class="n">tasks</span><span class="p">:</span> <span class="n">Task</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Update</span>
</span></span><span class="line"><span class="cl">    <span class="k">fun</span> <span class="nf">update</span><span class="p">(</span><span class="n">task</span><span class="p">:</span> <span class="n">Task</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Delete</span>
</span></span><span class="line"><span class="cl">    <span class="k">fun</span> <span class="nf">delete</span><span class="p">(</span><span class="n">task</span><span class="p">:</span> <span class="n">Task</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Note: The <code>getTasksByCompletion()</code> and <code>delete()</code> methods aren&rsquo;t actually used in this sample, but were added just for educational purposes.</p>
<p>From the above methods, the Query methods can use the <a href="https://developer.android.com/topic/libraries/architecture/room.html#daos-query-rxjava">Room RxJava2</a> integration to return <code>Flowable</code> objects. A <code>Flowable</code> is an RxJava component you can read about <a href="https://github.com/ReactiveX/RxJava/blob/2.x/DESIGN.md#flowable">here</a>.</p>
<h1 id="appdatabase">AppDatabase</h1>
<p>The last thing we need to create is our <a href="https://developer.android.com/reference/android/arch/persistence/room/Database.html">Database</a> class. This is an abstract class extending from <a href="https://developer.android.com/reference/android/arch/persistence/room/RoomDatabase.html">RoomDatabase</a> which defines the entities used in this database, it&rsquo;s version, and is the primary access point for the database.</p>
<p>In this example, I&rsquo;ve also decided to use the class with the Singleton Pattern to get a database instance for the app to use:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="nd">@Database</span><span class="p">(</span><span class="n">entities</span> <span class="p">=</span> <span class="n">arrayOf</span><span class="p">(</span><span class="n">Task</span><span class="o">::</span><span class="k">class</span><span class="p">),</span> <span class="n">version</span> <span class="p">=</span> <span class="m">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">abstract</span> <span class="k">class</span> <span class="nc">AppDatabase</span> <span class="p">:</span> <span class="n">RoomDatabase</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">abstract</span> <span class="k">fun</span> <span class="nf">taskDao</span><span class="p">():</span> <span class="n">TaskDAO</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">companion</span> <span class="k">object</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">private</span> <span class="k">var</span> <span class="py">INSTANCE</span><span class="p">:</span> <span class="n">AppDatabase</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span>
</span></span><span class="line"><span class="cl">            <span class="k">private</span> <span class="k">set</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">fun</span> <span class="nf">getInMemoryDatabase</span><span class="p">(</span><span class="n">context</span><span class="p">:</span> <span class="n">Context</span><span class="p">):</span> <span class="n">AppDatabase</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">INSTANCE</span> <span class="o">==</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">INSTANCE</span> <span class="p">=</span> <span class="nc">Room</span><span class="p">.</span><span class="n">databaseBuilder</span><span class="p">(</span><span class="n">context</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="n">AppDatabase</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">java</span><span class="p">,</span> <span class="s2">&#34;todo-list&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="p">.</span><span class="n">build</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">INSTANCE</span><span class="o">!!</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>For every DAO you create, you&rsquo;ll need a corresponding abstract method for that DAO inside of this class. If you want to learn more about database migrations, which aren&rsquo;t covered in this post, you can read about them <a href="https://developer.android.com/topic/libraries/architecture/room.html#db-migration">here</a>.</p>
<h1 id="accessing-the-database---notes">Accessing The Database - Notes</h1>
<p>Now that we&rsquo;ve created our AppDatabase, we can call <code>AppDatabase.getInMemoryDatabase(context).taskDao()...</code> to perform database operations. However, Room does not allow you to access the database on the main thread as it could produce Application Not Responding (ANR) errors. Your choices are to move the code to a separate thread yourself, or if you insist you can use the <a href="https://developer.android.com/reference/android/arch/persistence/room/RoomDatabase.Builder.html#allowMainThreadQueries%28%29">allowOnMainThread()</a> method in your builder.</p>
<p>I&rsquo;ve also decided to make use of Kotlin&rsquo;s extension methods, to create an extension method on a Context to easily access our database from an activity or view context seen later in the post:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">fun</span> <span class="nf">Context</span><span class="p">.</span><span class="n">taskDao</span><span class="p">():</span> <span class="n">TaskDAO</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nc">AppDatabase</span><span class="p">.</span><span class="n">getInMemoryDatabase</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="n">taskDao</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h1 id="query">Query</h1>
<p>Now that we have our database setup, let&rsquo;s first go over our implementation of the query calls. Since our queries return RxJava Flowables, we&rsquo;ll use that object to subscribe on a new thread, observe on the main thread, and update the tasks in our <code>RecyclerView.Adapter</code> when it&rsquo;s done, like this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="n">taskDao</span><span class="p">().</span><span class="n">getAll</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="n">subscribeOn</span><span class="p">(</span><span class="nc">Schedulers</span><span class="p">.</span><span class="n">newThread</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="n">observeOn</span><span class="p">(</span><span class="nc">AndroidSchedulers</span><span class="p">.</span><span class="n">mainThread</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="n">subscribe</span><span class="p">({</span> <span class="n">adapter</span><span class="p">.</span><span class="n">tasks</span> <span class="p">=</span> <span class="k">it</span> <span class="p">})</span>
</span></span></code></pre></div><p>For the full Activity and Adapter code, please see <a href="https://github.com/androidessence/todo-room">GitHub</a>.</p>
<h1 id="insert">Insert</h1>
<p>To insert into the database, I&rsquo;ve used an RxJava <a href="https://github.com/ReactiveX/RxJava/blob/2.x/DESIGN.md#single">Single</a> to run this action asynchronously:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="nc">Single</span><span class="p">.</span><span class="n">fromCallable</span> <span class="p">{</span> <span class="n">taskDao</span><span class="p">().</span><span class="n">insertAll</span><span class="p">(</span><span class="n">task</span><span class="p">)</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="n">subscribeOn</span><span class="p">(</span><span class="nc">Schedulers</span><span class="p">.</span><span class="n">newThread</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="n">subscribe</span><span class="p">()</span>
</span></span></code></pre></div><h1 id="update-1">Update</h1>
<p>This was a little tricky. I tried using a Single just like the last example, but I couldn&rsquo;t quite get it to work. You can read more about the question and solution on <a href="https://stackoverflow.com/questions/44477568/calling-an-rxjava-single-in-kotlin-lambda">StackOverflow</a>, but here is the code inside of the ViewHolder:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">TaskViewHolder</span><span class="p">(</span><span class="n">view</span><span class="p">:</span> <span class="n">View</span><span class="p">?,</span> <span class="n">taskAdapter</span><span class="p">:</span> <span class="n">TaskAdapter</span><span class="p">)</span> <span class="p">:</span> <span class="nc">RecyclerView</span><span class="p">.</span><span class="n">ViewHolder</span><span class="p">(</span><span class="n">view</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">adapter</span><span class="p">:</span> <span class="n">WeakReference</span><span class="p">&lt;</span><span class="n">TaskAdapter</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">WeakReference</span><span class="p">(</span><span class="n">taskAdapter</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">descriptionTextView</span> <span class="p">=</span> <span class="n">view</span><span class="o">?.</span><span class="n">findViewById</span><span class="p">(</span><span class="nc">R</span><span class="p">.</span><span class="n">id</span><span class="p">.</span><span class="n">task_description</span><span class="p">)</span> <span class="k">as</span><span class="p">?</span> <span class="n">TextView</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">completedCheckBox</span> <span class="p">=</span> <span class="n">view</span><span class="o">?.</span><span class="n">findViewById</span><span class="p">(</span><span class="nc">R</span><span class="p">.</span><span class="n">id</span><span class="p">.</span><span class="n">task_completed</span><span class="p">)</span> <span class="k">as</span><span class="p">?</span> <span class="n">CheckBox</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">lateinit</span> <span class="k">var</span> <span class="py">emitter</span><span class="p">:</span> <span class="n">ObservableEmitter</span><span class="p">&lt;</span><span class="n">Task</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">val</span> <span class="py">disposable</span><span class="p">:</span> <span class="n">Disposable</span> <span class="p">=</span> <span class="nc">Observable</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="n">ObservableOnSubscribe</span><span class="p">&lt;</span><span class="n">Task</span><span class="p">&gt;</span> <span class="p">{</span> <span class="n">e</span> <span class="o">-&gt;</span> <span class="n">emitter</span> <span class="p">=</span> <span class="n">e</span> <span class="p">})</span>
</span></span><span class="line"><span class="cl">            <span class="p">.</span><span class="n">subscribeOn</span><span class="p">(</span><span class="nc">Schedulers</span><span class="p">.</span><span class="n">newThread</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">            <span class="p">.</span><span class="n">observeOn</span><span class="p">(</span><span class="nc">Schedulers</span><span class="p">.</span><span class="n">newThread</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">            <span class="p">.</span><span class="n">subscribe</span><span class="p">({</span> <span class="n">itemView</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">taskDao</span><span class="p">().</span><span class="n">update</span><span class="p">(</span><span class="k">it</span><span class="p">)</span> <span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">fun</span> <span class="nf">bindTask</span><span class="p">(</span><span class="n">task</span><span class="p">:</span> <span class="n">Task</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">descriptionTextView</span><span class="o">?.</span><span class="n">text</span> <span class="p">=</span> <span class="n">task</span><span class="p">.</span><span class="n">description</span>
</span></span><span class="line"><span class="cl">        <span class="n">completedCheckBox</span><span class="o">?.</span><span class="n">isChecked</span> <span class="p">=</span> <span class="n">task</span><span class="p">.</span><span class="n">completed</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">completedCheckBox</span><span class="o">?.</span><span class="n">setOnCheckedChangeListener</span> <span class="p">{</span> <span class="n">_</span><span class="p">,</span> <span class="n">isChecked</span> <span class="o">-&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="n">adapter</span><span class="p">.</span><span class="k">get</span><span class="p">()</span><span class="o">?.</span><span class="n">tasks</span><span class="o">?.</span><span class="k">get</span><span class="p">(</span><span class="n">adapterPosition</span><span class="p">)</span><span class="o">?.</span><span class="n">completed</span> <span class="p">=</span> <span class="n">isChecked</span>
</span></span><span class="line"><span class="cl">            <span class="n">emitter</span><span class="p">.</span><span class="n">onNext</span><span class="p">(</span><span class="n">adapter</span><span class="p">.</span><span class="k">get</span><span class="p">()</span><span class="o">?.</span><span class="n">tasks</span><span class="o">?.</span><span class="k">get</span><span class="p">(</span><span class="n">adapterPosition</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>That is all of the Room related code for this tutorial! You can find all of this <a href="https://github.com/androidessence/todo-room">on GitHub</a>, but those of you familiar with SQLite on Android can already see how much simpler this was. We didn&rsquo;t have to write any table contracts, define individual columns, write a pesky SQLiteOpenHelper, or any of that boilerplate work.</p>
            </div>
        </article></main>
</div>
<footer class="footer">
    <span class="footer_item"> </span>
    &nbsp;

    <div class="footer_social-icons">
<a href="https://twitch.tv/adammc" target="_blank" rel="noopener noreferrer me"
    title="Twitch">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path d="M21 2H3v16h5v4l4-4h5l4-4V2zm-10 9V7m5 4V7"></path>
</svg>
</a>
<a href="https://bsky.app/profile/adammc.bsky.social" target="_blank" rel="noopener noreferrer me"
    title="Bluesky">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" stroke="none" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path
    d="M11.999,10.236c0.321,-0.524 0.916,-1.507 1.405,-2.376c0.755,-1.344 1.692,-2.852 2.869,-4.028c1.283,-1.281 2.845,-2.171 4.739,-2.171c1.144,-0 1.864,0.585 2.299,1.497c0.486,1.017 0.545,2.551 0.51,3.883c-0.051,1.945 -0.232,3.337 -0.505,4.275c-0.229,0.786 -0.543,1.303 -0.878,1.615c-0.892,0.833 -1.8,1.263 -2.634,1.484c0.029,0.018 0.056,0.036 0.084,0.055c0.528,0.367 0.823,0.79 1.081,1.107c0.648,0.794 0.644,1.795 0.23,2.784c-0.481,1.151 -1.533,2.279 -2.12,2.773c-1.389,1.171 -2.506,1.362 -3.383,1.133c-0.88,-0.23 -1.59,-0.932 -2.156,-1.826c-0.45,-0.71 -0.817,-1.537 -1.176,-2.186c-0.115,-0.208 -0.302,-0.455 -0.406,-0.587c-0.02,0.019 -0.04,0.04 -0.056,0.058c-0.121,0.145 -0.234,0.328 -0.349,0.531c-0.363,0.644 -0.721,1.463 -1.157,2.166c-0.555,0.895 -1.252,1.597 -2.12,1.825c-0.863,0.227 -1.97,0.037 -3.363,-1.136c-0.586,-0.494 -1.638,-1.622 -2.119,-2.773c-0.414,-0.989 -0.418,-1.99 0.229,-2.784c0.258,-0.317 0.554,-0.74 1.082,-1.106c0.027,-0.019 0.055,-0.038 0.084,-0.056c-0.834,-0.221 -1.742,-0.651 -2.634,-1.484c-0.335,-0.312 -0.649,-0.829 -0.878,-1.615c-0.273,-0.938 -0.454,-2.33 -0.505,-4.275c-0.036,-1.332 0.024,-2.866 0.509,-3.883c0.435,-0.912 1.156,-1.497 2.3,-1.497c2.32,0 4.109,1.203 5.494,2.808c1.272,1.474 2.195,3.283 2.9,4.643c0.231,0.447 0.436,0.84 0.624,1.146Zm-0.01,5.653l0.296,0.031l0.271,0.086c0.208,0.088 0.413,0.229 0.607,0.428c0.455,0.467 0.882,1.369 1.36,2.284c0.249,0.477 0.518,0.958 0.841,1.339c0.231,0.274 0.483,0.502 0.805,0.569c0.488,0.103 1.052,-0.157 1.811,-0.797c0.452,-0.38 1.274,-1.239 1.645,-2.126c0.155,-0.371 0.265,-0.75 0.022,-1.048c-0.179,-0.22 -0.366,-0.529 -0.732,-0.783c-0.536,-0.372 -1.356,-0.51 -1.905,-0.654c-0.405,-0.106 -0.715,-0.234 -0.88,-0.355l-0.284,-0.303l-0.135,-0.367l-0.008,-0.211l0.035,-0.196l0.078,-0.195l0.142,-0.209l0.198,-0.181l0.296,-0.154c0.151,-0.055 0.348,-0.092 0.587,-0.104c0.815,-0.042 2.571,0.294 4.235,-1.259c0.171,-0.159 0.288,-0.445 0.404,-0.845c0.246,-0.843 0.391,-2.096 0.438,-3.843c0.024,-0.91 0.026,-1.938 -0.208,-2.738c-0.142,-0.486 -0.367,-0.891 -0.896,-0.891c-1.675,0 -2.974,0.983 -4.031,2.21c-1.179,1.369 -2.058,3.057 -2.752,4.321c-0.483,0.88 -0.902,1.573 -1.25,1.916c-0.088,0.086 -0.174,0.157 -0.257,0.214l-0.221,0.125l-0.228,0.078l-0.267,0.031l-0.274,-0.034l-0.231,-0.083l-0.219,-0.132c-0.081,-0.058 -0.164,-0.131 -0.248,-0.22c-0.327,-0.343 -0.718,-1.037 -1.174,-1.917c-0.654,-1.262 -1.497,-2.948 -2.676,-4.314c-1.067,-1.236 -2.417,-2.217 -4.203,-2.217c-0.53,0 -0.754,0.405 -0.896,0.891c-0.234,0.8 -0.232,1.828 -0.208,2.738c0.046,1.747 0.192,3 0.438,3.843c0.116,0.4 0.233,0.686 0.403,0.845c1.665,1.553 3.421,1.217 4.235,1.259c0.24,0.012 0.437,0.049 0.588,0.104l0.295,0.154l0.199,0.181l0.142,0.209l0.078,0.195l0.035,0.196l-0.009,0.211l-0.135,0.368l-0.283,0.303c-0.165,0.12 -0.476,0.248 -0.88,0.355c-0.549,0.144 -1.369,0.281 -1.905,0.653c-0.366,0.254 -0.554,0.564 -0.732,0.783c-0.243,0.298 -0.133,0.677 0.022,1.048c0.371,0.887 1.193,1.746 1.645,2.127c0.757,0.637 1.311,0.9 1.789,0.8c0.311,-0.066 0.55,-0.29 0.772,-0.557c0.315,-0.381 0.577,-0.86 0.822,-1.337c0.394,-0.763 0.752,-1.521 1.138,-2.01c0.431,-0.544 0.929,-0.815 1.455,-0.815Z" style="fill-rule:nonzero;"/>
</svg>
</a>
<a href="https://www.youtube.com/@AdamMc331" target="_blank" rel="noopener noreferrer me"
    title="Youtube">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path
        d="M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 11.75a29 29 0 0 0 .46 5.33A2.78 2.78 0 0 0 3.4 19c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2 29 29 0 0 0 .46-5.25 29 29 0 0 0-.46-5.33z">
    </path>
    <polygon points="9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02"></polygon>
</svg>
</a>
<a href="https://github.com/AdamMc331" target="_blank" rel="noopener noreferrer me"
    title="Github">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path
        d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22">
    </path>
</svg>
</a>
<a href="/index.xml" target="_blank" rel="noopener noreferrer me"
    title="Rss">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path d="M4 11a9 9 0 0 1 9 9" />
    <path d="M4 4a16 16 0 0 1 16 16" />
    <circle cx="5" cy="19" r="1" />
</svg>
</a>
</div>
    <small class="footer_copyright">
        © 2025 Adam McNeilly.
        Powered by <a href="https://github.com/hugo-sid/hugo-blog-awesome" target="_blank" rel="noopener">Hugo blog awesome</a>.
    </small>
</footer><a href="#" title="Go to top" id="totop">
    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" stroke="currentColor" viewBox="0 96 960 960">
    <path d="M283 704.739 234.261 656 480 410.261 725.739 656 677 704.739l-197-197-197 197Z"/>
</svg>

</a>


    




    
    
        
    

    
    
        
    



    
    <script async src="http://localhost:1313/js/main.js" ></script>

    

</body>
</html>
